# AI 모듈 구현 계획 비교 분석

> **비교 대상:**  
> - 원본: `old_AI_setting.md` (정본 9장 AI 로직, 1294줄)  
> - 제안: `ai_module_implementation.md` (제가 작성한 구현 계획)

---

## 📊 **전체 비교 요약**

| 항목 | 원본 (정본 9장) | 제 제안 | 일치도 |
|---|---|---|---|
| **전체 파이프라인** | ✅ Perception → P1 → P2 → P3 → 검색/재랭킹 | ✅ YOLO/CLIP/OCR → 통합 → P2-P3-Scoring | 🟡 70% |
| **객체 인식** | ✅ SSD MobileNet V3 / YOLOv5n | ✅ YOLOv8 | 🟢 90% |
| **장면 분석** | ✅ CLIP 명시됨 | ✅ CLIP | 🟢 100% |
| **OCR** | ✅ OCR 엔진 (구체적 명시 없음) | ✅ EasyOCR | 🟢 95% |
| **감정 인식** | ✅ MobileNetV2 + 7개 감정 | ❌ 제 계획에 없음 | 🔴 0% |
| **120 피사체** | ✅ 상세 정의됨 | ✅ detection_labels_map.csv 언급 | 🟢 100% |
| **24 주제** | ✅ 상세 정의됨 | ✅ 동일 | 🟢 100% |
| **P1 상징 매핑** | ✅ 5개 코어 군 (46개 상징) | ✅ 언급했으나 상세 없음 | 🟡 60% |
| **P2 주제 매핑** | ✅ 120×24 매트릭스 | ✅ topic_weights_v1.csv | 🟢 100% |
| **P3 컨텍스트 보정** | ✅ 시간/장소/시각특징 보정 | ✅ theological_safety_rules.json | 🟢 90% |
| **성능 목표** | ✅ p95 < 800ms | ✅ p95 < 800ms | 🟢 100% |

---

## ✅ **일치하는 부분 (제가 잘 파악한 것)**

### 1. **전체 파이프라인 구조**
- ✅ **원본**: Perception → P1 상징 → P2 주제 → P3 보정 → 검색/재랭킹
- ✅ **제안**: 이미지 → YOLO/CLIP/OCR → 통합 → 주제 매핑 → 추천
- **평가**: 핵심 흐름은 동일하게 이해함

### 2. **AI 모델 선택**
- ✅ **YOLO**: 원본은 YOLOv5n, 제안은 YOLOv8 (최신 버전으로 업그레이드)
- ✅ **CLIP**: 완전 일치
- ✅ **OCR**: 원본은 미명시, 제안은 EasyOCR (적절한 선택)

### 3. **데이터 구조**
- ✅ **120 피사체 × 24 주제 매트릭스**: 완전 이해
- ✅ **detection_labels_map.csv**: COCO → 성경 상징 매핑 필요성 파악

### 4. **성능 목표**
- ✅ **p95 < 800ms**: 정확히 일치

---

## ⚠️ **누락된 부분 (제가 놓친 것)**

### 1. **감정 인식 모듈** ⭐ 중요!
**원본 (9.10.1.1.2):**
```
감정 인식 모델(Emotion Analysis Model):
- MobileNetV2 계열 경량 CNN
- 64×64 얼굴 크롭 입력
- 7개 기본 감정(행복·놀람·슬픔·분노·혐오·두려움·중립)
- softmax 확률 출력
```

**제 제안:**
- ❌ **완전 누락**

**영향:**
- 감정 인식은 **EmotionVector** 엔티티와 연결
- **EmotionScriptureMap**을 통해 감정 → 구절 매핑
- **Soul Chorus 게임과 데이터 공유** 가능

**조치 필요:**
- AI 모듈에 **감정 인식** 추가 필요

---

### 2. **P1 상징 레이어 상세 구조** ⭐ 중요!

**원본 (9.10.2.1):**
5개 코어 군으로 구성:
1. **자연(지형·천체·기상)** — 10코어
2. **생명(식물·동물·인간·표정)** — 9코어
3. **인공물(인간 제작물)** — 10코어
4. **인간 활동** — 10코어
5. **공간·장면** — 7코어

**총 46개 상징**, 각 상징마다:
- 의미/역할
- 주된 매핑 주제
- 개발자 메모 (탐지 힌트)

**제 제안:**
- ✅ 상징 매핑 개념은 언급
- ❌ 46개 상징 체계 누락
- ❌ 5개 코어 군 구조 누락

**조치 필요:**
- `symbol_definitions.csv` 생성 필요
- 46개 상징 → 120개 피사체 매핑 테이블

---

### 3. **민감 라우팅 (Safety Routing)** ⭐ 매우 중요!

**원본 (9.10.1.1.3):**
```
민감 라우팅(safety_flags) 규칙:
- 아동/의료: 비공개 권고 + 위로/보호 톤 우선
- 장례/병상: 위로/소망 우선, 정죄 차단
- 정치/갈등: 중립 권면, 선동 차단
- 정밀 위치: 좌표 저장 금지, 지오해시만
```

**제 제안:**
- ✅ `theological_safety_rules.json`에 일부 반영
- ❌ **Perception 이전** 단계의 민감 라우팅 누락
- ❌ `safety_flags` 자동 생성 로직 누락

**조치 필요:**
- Perception 전에 **민감 신호 탐지** 추가
- `safety_flags` 생성 로직 구현

---

### 4. **랜드마크 인식** 

**원본 (9.10.1.1):**
```
랜드마크 인식 (선택):
- 교회 외관, 산/바다, 도시 스카이라인 등
```

**제 제안:**
- ❌ 누락

**조치 필요:**
- 랜드마크 인식 모듈 추가 (선택적)
- 또는 CLIP으로 대체 가능

---

### 5. **S1-S4 점수 체계** ⭐ 중요!

**원본 (9.4):**
```
S1: Object / Scene Anchors (사물·장면·상징)
S2: Emotion Anchors (감정·정서)
S3: Action Anchors (행위·명령·동작)
S4: Theology Anchors (교리·신학)

score_total = (w1 × S1) + (w2 × S2) + (w3 × S3) + (w4 × S4)
priority_score = (score_total + bonus) / normalize_divisor
```

**제 제안:**
- ✅ S1-S4 개념은 파악
- ❌ **S2 (감정)** 누락 (감정 인식 모듈 없어서)
- ❌ **S3 (행위)** 구체적 구현 방법 누락
- ❌ **S4 (교리)** 구체적 구현 방법 누락

**조치 필요:**
- S2: 감정 인식 모듈 추가
- S3: 행위 인식 로직 추가 (CLIP 또는 별도 모델)
- S4: 교리 앵커 정의 및 매칭 로직

---

### 6. **오프라인팩 (Offline Pack)**

**원본 (9.9.7, 9.11.3):**
```
OfflinePack:
- 오프라인 상황에서 사용할 코어 구절·임베딩 묶음
- 온라인 복귀 시 배치 업로드
```

**제 제안:**
- ❌ 누락

**조치 필요:**
- 오프라인 모드 지원 계획 추가

---

## 🎯 **개선 제안 (제가 더 나은 부분)**

### 1. **최신 모델 사용**
- ✅ **YOLOv8** (원본: YOLOv5n) - 더 빠르고 정확
- ✅ **EasyOCR** 명시 (원본: OCR 엔진만 언급)

### 2. **구현 코드 예시 제공**
- ✅ 각 모듈별 Python 코드 예시
- ✅ 클래스 구조 및 API 설계

### 3. **실용적인 일정 계획**
- ✅ Day 1-3 상세 일정
- ✅ 각 모듈별 예상 소요 시간

---

## 📋 **통합 구현 계획 (수정안)**

### **Phase 3.2 AI 모듈 통합 (수정)**

#### **A. 객체 인식 (YOLO/COCO)** - 2-3시간
- YOLOv8 모델 통합
- 120개 피사체 → COCO 80개 클래스 매핑
- detection_labels_map.csv 생성

#### **B. 장면 인식 (CLIP)** - 2-3시간
- CLIP 모델 통합
- 장면 분류 (실내/실외, 시간대)
- **46개 상징** 후보 생성

#### **C. 감정 인식 (MobileNetV2)** ⭐ 추가!
- MobileNetV2 경량 CNN
- 7개 기본 감정 분류
- EmotionVector 생성

#### **D. OCR (EasyOCR)** - 1-2시간
- 한글/영어 텍스트 추출
- 성경 구절 패턴 감지

#### **E. 랜드마크 인식 (선택)** - 1시간
- CLIP 기반 랜드마크 분류
- 또는 별도 모델

#### **F. 민감 라우팅** ⭐ 추가!
- Perception 전 민감 신호 탐지
- safety_flags 생성
- 비공개/공유 정책 적용

#### **G. P1 상징 매핑** ⭐ 추가!
- 46개 상징 정의
- 5개 코어 군 구조
- 객체/장면/CLIP → 상징 변환

#### **H. 멀티모달 통합**
- S1-S4 점수 계산
- 가중합 및 우선순위 점수
- 최종 상징 Top 5 생성

---

## 🔑 **핵심 차이점 요약**

| 항목 | 원본 강조 | 제 제안 강조 |
|---|---|---|
| **감정 인식** | ⭐⭐⭐ 필수 | ❌ 누락 |
| **46개 상징 체계** | ⭐⭐⭐ 핵심 | 🟡 언급만 |
| **민감 라우팅** | ⭐⭐⭐ 필수 | 🟡 일부만 |
| **S1-S4 점수** | ⭐⭐⭐ 핵심 | 🟡 개념만 |
| **오프라인팩** | ⭐⭐ 중요 | ❌ 누락 |
| **최신 모델** | 🟡 YOLOv5n | ⭐⭐ YOLOv8 |
| **구현 코드** | ❌ 없음 | ⭐⭐⭐ 상세 |
| **일정 계획** | ❌ 없음 | ⭐⭐⭐ 구체적 |

---

## ✅ **최종 권장 사항**

### **즉시 반영 필요 (High Priority)**
1. ⭐ **감정 인식 모듈** 추가
2. ⭐ **46개 상징 체계** 정의
3. ⭐ **민감 라우팅** 구현
4. ⭐ **S2-S4 점수** 로직 추가

### **중요 (Medium Priority)**
5. **랜드마크 인식** 추가 (또는 CLIP으로 대체)
6. **오프라인팩** 지원 계획

### **유지 (제 제안이 더 나은 부분)**
7. ✅ YOLOv8 사용
8. ✅ EasyOCR 사용
9. ✅ 구현 코드 예시
10. ✅ 상세 일정 계획

---

## 📊 **최종 평가**

**제 이해도: 70/100**

**잘한 점:**
- ✅ 전체 파이프라인 구조 이해
- ✅ 주요 AI 모델 선택 (YOLO, CLIP, OCR)
- ✅ 데이터 구조 (120×24 매트릭스) 이해
- ✅ 실용적인 구현 계획 및 코드 예시

**놓친 점:**
- ❌ 감정 인식 모듈 (중요!)
- ❌ 46개 상징 체계 상세
- ❌ 민감 라우팅 전체 로직
- ❌ S2-S4 점수 구체적 구현
- ❌ 오프라인팩 지원

**다음 단계:**
1. `ai_module_implementation.md` 업데이트
2. 감정 인식 모듈 추가
3. 46개 상징 정의 파일 생성
4. 민감 라우팅 로직 추가
5. S1-S4 점수 계산 로직 상세화
